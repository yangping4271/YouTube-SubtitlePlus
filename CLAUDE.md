# YouTube SubtitlePlus - 项目配置

## 项目概述
YouTube SubtitlePlus 是一个Chrome扩展，允许用户在YouTube视频上显示本地字幕文件(SRT/VTT格式)，支持双语字幕显示和实时样式自定义。

## 开发环境配置

### 项目结构
```
YouTube-SubtitlePlus/
├── extension/              # Chrome扩展核心文件
│   ├── manifest.json       # 扩展配置
│   ├── content.js          # 内容脚本
│   ├── background.js       # 后台服务
│   ├── popup.html/js/css   # 用户界面
│   └── icons/              # 扩展图标
├── docs/                   # 项目文档
├── examples/               # 示例文件
└── tests/                  # 测试工具
```

### 开发规范

#### 代码风格
- 使用ES6+语法
- 避免使用过多的`!important`CSS声明
- 保持代码简洁、可读性强
- 使用有意义的变量和函数命名

#### 安装和使用
- 扩展安装：选择`extension/`文件夹加载到Chrome
- 测试页面：任意YouTube视频页面
- 调试工具：浏览器开发者工具Console

#### 文件管理
- **必需文件**：放在`extension/`文件夹
- **文档文件**：放在`docs/`文件夹  
- **示例文件**：放在`examples/`文件夹

### 技术栈
- **Chrome Manifest V3**
- **Vanilla JavaScript (ES6+)**
- **CSS3 (响应式设计)**
- **Chrome Extensions API**
  - chrome.storage (本地存储)
  - chrome.runtime (消息传递)
  - chrome.tabs (标签页管理)

### 核心功能模块

#### 1. 字幕解析 (SubtitleParser)
- SRT格式解析
- VTT格式解析
- 时间戳转换
- HTML标签清理

#### 2. 字幕显示 (YouTubeSubtitleOverlay)
- **全新Flexbox布局系统**：使用flex容器确保双语字幕完美居中和紧密排列
- **精确背景适配**：背景条严格按照文字内容长度自适应，无多余空间
- **优化的双语字幕间距**：2px间距确保英文和中文字幕既分离又紧凑
- **黑色半透明背景**：可自定义透明度的黑色背景，默认60%透明度
- 视频时间同步
- 多模式响应式布局适配（全屏/剧场/普通/迷你）
- 实时位置跟踪和自动调整

#### 3. 用户界面 (Popup)
- 文件上传处理
- 字幕开关控制
- **完善的样式设置**：字体大小、颜色、背景透明度等完全可自定义
- 状态信息显示

#### 4. 后台服务 (Background)
- 数据存储管理
- 消息路由处理
- 设置配置管理
- 扩展生命周期管理

### 开发指南

#### 本地开发
1. 修改`extension/`文件夹中的代码
2. 在`chrome://extensions/`重新加载扩展
3. 刷新YouTube页面测试功能
4. 使用开发者工具查看调试信息

#### 功能测试
- **基础功能**：字幕文件上传和显示
- **同步测试**：视频播放时字幕同步
- **样式测试**：全屏、剧场模式适配
- **性能测试**：大字幕文件处理

#### 代码提交
- 使用语义化提交信息
- 包含功能描述和技术细节
- 添加Claude Code生成标识

### 常见问题解决

#### 字幕不显示
1. 检查字幕是否正确上传
2. 确认字幕开关已开启
3. 验证视频时间在字幕范围内
4. 使用浏览器开发者工具检查Console错误

#### 样式和定位优化
- 使用`position: fixed`确保定位稳定
- 设置高`z-index`值避免遮挡
- 智能字体大小调整（基础+8px，全屏+12px）
- 背景透明度50%，内容自适应宽度
- 精确的视频中心对齐算法

#### 性能优化
- 避免频繁DOM操作
- 使用事件委托减少监听器
- 合理使用ResizeObserver和MutationObserver
- 智能节流的位置更新机制
- 高效的YouTube状态监听系统

### 发布准备

#### 扩展商店发布
1. 准备扩展描述和截图
2. 设置合适的权限申请
3. 测试不同Chrome版本兼容性
4. 准备隐私政策文档

#### 版本管理
- 遵循语义化版本号 (major.minor.patch)
- 更新manifest.json中的版本号
- 记录CHANGELOG变更日志

## 项目状态
- ✅ 核心功能完成
- ✅ UI界面优化
- ✅ 智能定位系统完善
- ✅ 样式系统优化
- ✅ 多模式适配完成
- ✅ 调试工具完备
- ✅ 代码结构规范
- ✅ 文档完善
- ✅ 双语字幕功能完成
- ✅ **字幕布局系统重构**：全新Flexbox布局，完美间距控制
- ✅ **样式系统完善**：所有设置项完全生效，用户体验优化
- ✅ **ASS双语字幕解析修复**：正确识别Default/Secondary样式分配英文/中文字幕
- ✅ **本地服务器管理完善**：提供完整的启动/停止脚本，智能进程管理
- ✅ **uv项目管理优化**：修复依赖冲突，确保服务器稳定运行
- 🔄 持续优化中

## 最新功能特性
- **双语字幕显示**：支持同时显示英文和中文字幕，英文在上，中文在下
- **全新Flexbox布局**：使用现代CSS Flexbox技术实现完美居中和紧密排列
- **精确背景适配**：每个字幕独立的黑色半透明背景，根据内容长度严格自适应
- **优化间距系统**：2px的双语字幕间距，既保持分离又确保紧凑视觉效果
- **ASS双语字幕智能解析**：
  - 正确识别Default样式为英文字幕
  - 正确识别Secondary样式为中文字幕
  - 支持683条英文+683条中文的完整双语字幕
- **本地服务器自动化管理**：
  - `start_server.sh`：智能启动脚本，支持uv和传统Python环境
  - `stop_server.sh`：优雅停止脚本，温和终止+强制清理
  - 完整的进程监控和端口管理
- **完全可自定义样式**：
  - 字体大小：12-32px可调（默认16px）
  - 字体颜色：完全自定义（默认白色）
  - 背景透明度：0-100%可调（默认60%）
  - 位置设置：底部/顶部/中央可选
- **动态字幕定位**：根据视频播放器位置实时调整字幕显示
- **多模式智能适配**：全屏、剧场、普通、迷你播放器自动适配
- **高性能监听**：ResizeObserver、MutationObserver、事件监听优化

---
*最后更新：2025年8月*